<Window x:Class="FolderIconManager.GUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:FolderIconManager.GUI"
        Title="Folder Icon Manager" 
        Height="700" Width="1000"
        MinHeight="500" MinWidth="700"
        Background="{StaticResource BackgroundDarkBrush}"
        WindowStartupLocation="CenterScreen">
    
    <Window.DataContext>
        <local:MainViewModel/>
    </Window.DataContext>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
        </Grid.RowDefinitions>

        <!-- Header / Folder Selection -->
        <Border Grid.Row="0" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="6" Padding="16" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Folder Path -->
                <TextBox Grid.Column="0" Grid.Row="0"
                         Text="{Binding FolderPath, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource ModernTextBox}"
                         VerticalContentAlignment="Center"
                         Margin="0,0,8,0"/>

                <!-- Browse Button -->
                <Button Grid.Column="1" Grid.Row="0"
                        Content="Browse..."
                        Command="{Binding BrowseCommand}"
                        Style="{StaticResource ModernButton}"
                        Margin="0,0,8,0"/>

                <!-- Scan Button -->
                <Button Grid.Column="2" Grid.Row="0"
                        Content="ðŸ” Scan"
                        Command="{Binding ScanCommand}"
                        Style="{StaticResource PrimaryButton}"
                        IsEnabled="{Binding CanScan}"
                        Margin="0,0,8,0"/>

                <!-- Options -->
                <StackPanel Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" 
                            Orientation="Horizontal" Margin="0,12,0,0">
                    <CheckBox Content="Include subfolders" 
                              IsChecked="{Binding IncludeSubfolders}"
                              Style="{StaticResource ModernCheckBox}"
                              Margin="0,0,24,0"/>
                    <CheckBox Content="Skip already local icons" 
                              IsChecked="{Binding SkipExisting}"
                              Style="{StaticResource ModernCheckBox}"/>
                </StackPanel>

                <!-- Status -->
                <TextBlock Grid.Column="3" Grid.Row="0" Grid.RowSpan="2"
                           Text="{Binding StatusText}"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"
                           Margin="16,0,0,0"/>
            </Grid>
        </Border>

        <!-- Folder List -->
        <Border Grid.Row="1" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="6" Margin="0,0,0,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <DataGrid Grid.Row="0"
                          ItemsSource="{Binding Folders}"
                          SelectedItem="{Binding SelectedFolder}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Extended"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserReorderColumns="False"
                          BorderThickness="0"
                          Margin="1">
                    <DataGrid.Columns>
                        <!-- Status Icon -->
                        <DataGridTemplateColumn Header="" Width="40">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding StatusIcon}" 
                                               FontSize="16" 
                                               HorizontalAlignment="Center"
                                               ToolTip="{Binding StatusDescription}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Status Text -->
                        <DataGridTextColumn Header="Status" 
                                            Binding="{Binding StatusText}" 
                                            Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{Binding StatusBrush}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Folder Path -->
                        <DataGridTextColumn Header="Folder" 
                                            Binding="{Binding FolderPath}" 
                                            Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Source -->
                        <DataGridTextColumn Header="Icon Source" 
                                            Binding="{Binding SourceDescription}" 
                                            Width="250">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Action Buttons -->
                <Border Grid.Row="1" Background="{StaticResource BackgroundDarkBrush}" 
                        Padding="12,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Summary -->
                        <TextBlock Grid.Column="0" 
                                   Text="{Binding SummaryText}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>

                        <!-- Fix Selected -->
                        <Button Grid.Column="2"
                                Content="Fix Selected"
                                Command="{Binding FixSelectedCommand}"
                                Style="{StaticResource ModernButton}"
                                IsEnabled="{Binding HasSelection}"
                                Margin="0,0,8,0"/>

                        <!-- Fix All External -->
                        <Button Grid.Column="3"
                                Content="ðŸ”§ Fix All External"
                                Command="{Binding FixAllCommand}"
                                Style="{StaticResource PrimaryButton}"
                                IsEnabled="{Binding HasExternalIcons}"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Splitter -->
        <GridSplitter Grid.Row="2" Height="4" HorizontalAlignment="Stretch" 
                      Background="Transparent" Cursor="SizeNS"/>

        <!-- Log Panel -->
        <Border Grid.Row="3" Background="{StaticResource BackgroundMediumBrush}" 
                CornerRadius="6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Log Header -->
                <Border Grid.Row="0" Background="{StaticResource BackgroundDarkBrush}" 
                        CornerRadius="6,6,0,0" Padding="12,8">
                    <Grid>
                        <TextBlock Text="Log" 
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontWeight="SemiBold"/>
                        <Button Content="Clear" 
                                Command="{Binding ClearLogCommand}"
                                Style="{StaticResource ModernButton}"
                                Padding="8,4"
                                HorizontalAlignment="Right"/>
                    </Grid>
                </Border>

                <!-- Log Content -->
                <ScrollViewer Grid.Row="1" 
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Auto"
                              x:Name="LogScrollViewer">
                    <ItemsControl ItemsSource="{Binding LogEntries}" Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" 
                                           FontFamily="Cascadia Code, Consolas, Courier New"
                                           FontSize="12"
                                           Foreground="{Binding Converter={StaticResource LogLevelToBrushConverter}}"
                                           Margin="0,1"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>

